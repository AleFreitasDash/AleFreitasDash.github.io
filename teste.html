<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Index</title>
    <link href="https://fonts.googleapis.com/css2?family=Material+Icons" rel="stylesheet">
    <link href="./vendor/bootstrap-select/dist/css/bootstrap-select.min.css" rel="stylesheet">
    <link href="./css/stylee.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
</head>
<body>
    <div id="main-wrapper">
        <div class="header">
            <div class="header-content">
                <nav class="navbar navbar-expand">
                    <div class="collapse navbar-collapse justify-content-between">
                        <ul class="navbar-nav header-right">
                            <li class="nav-item align-items-center header-border">
                                <a href="analytics.html" class="btn btn-primary">Relatório</a>
                            </li>
                        </ul>
                    </div>
                </nav>
            </div>
        </div>
        <div class="outer-body">
            <div class="inner-body">
                <div class="content-body">
                    <div class="container-fluid">
                        <h1>Upload de Arquivo XLSX</h1>
                        <input type="file" id="file" accept=".xlsx">
                        <button onclick="uploadFile()">Upload</button>
                        <h2>Dados Processados:</h2>
                        <div id="processed-data"></div>
                        <script>
                            async function uploadFile() {
                                const fileInput = document.getElementById('file');
                                const file = fileInput.files[0];
                                const reader = new FileReader();

                                reader.onload = async function(e) {
                                    const data = e.target.result;
                                    const workbook = XLSX.read(data, { type: 'binary' });
                                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                                    const json = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });

                                    const response = await fetch('https://script.google.com/macros/s/AKfycbwQ9-9c9RJGCkXpQN51EI3Uz62MBB0g3mRQk_yhRGX2hZQLRtJ_tQetJYE-bPTzCENLFw/exec', {
                                        method: 'POST',
                                        headers: {
                                            'Content-Type': 'application/json',
                                        },
                                        body: JSON.stringify(json)
                                    });

                                    const result = await response.json();
                                    if (result.status === 'success') {
                                        displayData(result.data);
                                    } else {
                                        alert('Erro: ' + result.message);
                                    }
                                };

                                reader.readAsBinaryString(file);
                            }

                            function displayData(data) {
                                const container = document.getElementById('processed-data');
                                container.innerHTML = '';
                                const table = document.createElement('table');
                                table.border = '1';

                                data.forEach((row, rowIndex) => {
                                    const tr = document.createElement('tr');
                                    row.forEach((cell) => {
                                        const cellElement = document.createElement(rowIndex === 0 ? 'th' : 'td');
                                        cellElement.textContent = cell;
                                        tr.appendChild(cellElement);
                                    });
                                    table.appendChild(tr);
                                });

                                container.appendChild(table);
                            }
                        </script>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer out-footer">
            <div class="copyright">
                <p>Copyright © Desenvolvido por Alexandre Freitas 2024</p>
            </div>
        </div>
    </div>
    <script src="./vendor/global/global.minn.js"></script>
    <script src="./vendor/bootstrap-select/dist/js/bootstrap-select.minn.js"></script>
    <script src="./js/customm.js"></script>
    <script src="./js/deznav-initt.js"></script>
    <script src="./js/demoo.js"></script>
</body>
</html>
